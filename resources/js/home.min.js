var userCount=0,userAmount=15,defaultUserImage="/profile_images/defaultProfileImage.png",usersList=[],friendsList=[],friendsPendingList=[],formatDate=function(a){var c=a.getHours(),b=a.getMinutes(),e=12<=c?"pm":"am";c%=12;c=(c?c:12)+":"+(10>b?"0"+b:b)+" "+e;return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()+"  "+c},setMessage=function(a,c){"error"===a?($("#errorMessages").text(c),$("#errorMessages").removeClass("hide"),setTimeout(function(){$("#errorMessages").addClass("hide")},1E4)):"success"===
a?($("#successMessages").text(c),$("#successMessages").removeClass("hide"),setTimeout(function(){$("#successMessages").addClass("hide")},1E4)):"info"===a&&($("#infoMessages").text(c),$("#infoMessages").removeClass("hide"),setTimeout(function(){$("#infoMessages").addClass("hide")},1E4))},removeFriendFromList=function(a){friendsList=friendsList.slice(friendsList.indexOf(findUserObj(friendsList,a)),-1)},removeFriendFromPendingList=function(a){friendsPendingList=friendsPendingList.slice(friendsPendingList.indexOf(findUserObj(friendsPendingList,
a)),-1)},findUserObj=function(a,c){var b;a.forEach(function(a){a.Username===c&&(b=a)});return b},getUsers=function(){$.ajax({type:"GET",url:"/home/getUserProfiles",data:{userIndex:userCount,numUsers:userAmount},success:function(a){"error"!==a?(createUserTable(a,0===userCount,"userTable"),usersList=a):setMessage("error","An error occured while getting user info.");userCount+=userAmount}})},createUserTable=function(a,c,b){var e=$("#"+b),n=document.createElement("tbody");n.id=b;"userTable"===b?$("#sendFriendRequest").show():
$("#sendFriendRequest").hide();c?(a.forEach(function(a){var e=document.createElement("tr"),c=document.createElement("td"),d=document.createElement("img"),p=document.createElement("td"),g=document.createElement("div"),f=document.createElement("a"),l=document.createElement("td"),q=document.createElement("td");e.setAttribute("scope","row");null===a.profileImage||"null"===a.profileImage?d.setAttribute("src",defaultUserImage):d.setAttribute("src",a.profileImage);d.setAttribute("alt","profile pic");d.classList.add("img-rounded");
d.classList.add("img-thumbnail");d.setAttribute("height","50");d.setAttribute("width","50");f.setAttribute("href",("#"+a.Username).toString());f.setAttribute("id",a.Username);g.innerText=a.Username;f.addEventListener("click",function(a){a.preventDefault();setUserModal(a.target.innerText,b);$("#inspectUser").modal("show")});l.innerText=a.FirstName;q.innerText=a.LastName;f.appendChild(g);p.appendChild(f);c.appendChild(d);e.appendChild(c);e.appendChild(p);e.appendChild(l);e.appendChild(q);"friendsTable"===
b&&(c=document.createElement("button"),d=document.createElement("td"),c.setAttribute("class","btn btn-danger"),c.setAttribute("type","button"),c.setAttribute("id",a.Username),c.innerText="Remove",c.addEventListener("click",function(a){deleteFriend(a.target.id)}),d.appendChild(c),d.setAttribute("class","text-right"),e.appendChild(d));n.appendChild(e)}),e.replaceWith(n)):a.forEach(function(a){var c=document.createElement("tr"),n=document.createElement("td"),d=document.createElement("img"),p=document.createElement("td"),
g=document.createElement("div"),f=document.createElement("a"),l=document.createElement("td"),q=document.createElement("td");c.setAttribute("scope","row");null===a.profileImage||"null"===a.profileImage?d.setAttribute("src",defaultUserImage):d.setAttribute("src",a.profileImage);d.setAttribute("alt","profile pic");d.classList.add("img-rounded");d.classList.add("img-thumbnail");d.setAttribute("height","50");d.setAttribute("width","50");f.setAttribute("href",("#"+a.Username).toString());f.setAttribute("id",
a.Username);g.innerText=a.Username;f.addEventListener("click",function(a){a.preventDefault();setUserModal(a.target.innerText,b);$("#inspectUser").modal("show")});l.innerText=a.FirstName;q.innerText=a.LastName;f.appendChild(g);p.appendChild(f);n.appendChild(d);c.appendChild(n);c.appendChild(p);c.appendChild(l);c.appendChild(q);e.append(c)})},searchUserTable=function(){userCount=0;userAmount=15;""!==$("#searchSiteBar").val().toString().trim()?$.ajax({url:"/home/searchUsers",data:{searchTerm:$("#searchSiteBar").val().toString().trim()},
success:function(a){"error"!==a?(createUserTable(a,!0,"userTable"),usersList=a):setMessage("error","There was an error while searching for users.")}}):getUsers()},setUserModal=function(a,c){"userTable"===c?usersList.forEach(function(b){b.Username===a&&(null!==b.profileImage&&"null"!==b.profileImage&&$("#inspectProfileImage").attr("src",b.profileImage),$("#inspectUsername").text(b.Username),$("#inspectFirstName").text(b.FirstName),$("#inspectLastName").text(b.LastName),$("#inspectBio").text(b.bio),
$("#inspectEmail").text(b.email),$("#inspectPhoneNumber").text(b.phone_number))}):"friendsTable"===c?friendsList.forEach(function(b){b.Username===a&&(null!==b.profileImage&&"null"!==b.profileImage&&$("#inspectProfileImage").attr("src",b.profileImage),$("#inspectUsername").text(b.Username),$("#inspectFirstName").text(b.FirstName),$("#inspectLastName").text(b.LastName),$("#inspectBio").text(b.bio),$("#inspectEmail").text(b.email),$("#inspectPhoneNumber").text(b.phone_number))}):"friendsPendingTable"===
c&&friendsPendingList.forEach(function(b){b.Username===a&&(null!==b.profileImage&&"null"!==b.profileImage&&$("#inspectProfileImage").attr("src",b.profileImage),$("#inspectUsername").text(b.Username),$("#inspectFirstName").text(b.FirstName),$("#inspectLastName").text(b.LastName),$("#inspectBio").text(b.bio),$("#inspectEmail").text(b.email),$("#inspectPhoneNumber").text(b.phone_number))})},getAdditonalInfo=function(){$.ajax({url:"/home/getAdditionalInfo",success:function(a){"error"!==a?($("#bio").val("null"===
a.bio?"":a.bio),$("#email").val("null"===a.email?"":a.email),$("#phoneNumber").val(null===a.phone_number?"":a.phone_number),$("#profileImage").attr("src","null"===a.profileImage?defaultUserImage:a.profileImage),$("#imageLink").val("null"===a.profileImage?"":a.profileImage)):setMessage("error","There was an error getting your profile information.")}})},sendFriendRequest=function(a){$("#inspectUser").modal("hide");$.ajax({url:"/home/sendFriendRequest",data:{friendTo:a},success:function(a){"error"===
a?setMessage("error","There was an error sending friend request."):"requested"===a?setMessage("error","This friend has already been requested."):setMessage("success","Friend request was sent successfully!")}})},createPendingRequestTable=function(a){var c=$("#friendsPendingTable"),b=document.createElement("tbody");b.id="friendsPendingTable";a.forEach(function(a){var e=document.createElement("tr"),c=document.createElement("td"),k=document.createElement("img"),h=document.createElement("td"),d=document.createElement("div"),
m=document.createElement("a"),g=document.createElement("td"),f=document.createElement("button"),l=document.createElement("button");e.setAttribute("scope","row");null===a.profileImage||"null"===a.profileImage?k.setAttribute("src",defaultUserImage):k.setAttribute("src",a.profileImage);k.setAttribute("alt","profile pic");k.classList.add("img-rounded");k.classList.add("img-thumbnail");k.setAttribute("height","50");k.setAttribute("width","50");m.setAttribute("href",("#"+a.Username).toString());m.setAttribute("id",
a.Username);d.innerText=a.Username;m.addEventListener("click",function(a){a.preventDefault();setUserModal(a.target.innerText,"friendsPendingTable");$("#inspectUser").modal("show")});f.setAttribute("class","btn btn-primary");f.setAttribute("type","button");f.setAttribute("id",a.Username);f.innerText="Accept";f.addEventListener("click",function(a){acceptFriendRequest(a.target.id)});l.setAttribute("class","btn btn-danger");l.setAttribute("type","button");l.setAttribute("id",a.Username);l.innerText="Reject";
l.addEventListener("click",function(a){rejectFriendRequest(a.target.id)});g.setAttribute("class","text-right");g.appendChild(f);g.appendChild(l);m.appendChild(d);h.appendChild(m);c.appendChild(k);e.appendChild(c);e.appendChild(h);e.appendChild(g);b.appendChild(e)});c.replaceWith(b)},getPendingRequests=function(){$.ajax({type:"GET",url:"/home/getPendingFriends",success:function(a){"error"!==a?(friendsPendingList=a,createPendingRequestTable(a)):setMessage("error","error while getting pending friend requests.");
userCount+=userAmount}})},getFriends=function(){$.ajax({type:"GET",url:"/home/getFriends",success:function(a){"error"!==a?(createUserTable(a,!0,"friendsTable"),friendsList=a):setMessage("error","error while getting friends list.");userCount+=userAmount}})},acceptFriendRequest=function(a){$.ajax({type:"GET",url:"/home/addFriend",data:{friend_username:a},success:function(c){"error"!==c?(setMessage("success","You are now friends with "+a+"!"),friendsList.push(findUserObj(friendsPendingList,a)),removeFriendFromPendingList(a),
createUserTable(friendsList,!0,"friendsTable"),createPendingRequestTable(friendsPendingList)):setMessage("error","There was an error accepting the friend request from "+a)}})},rejectFriendRequest=function(a){$.ajax({type:"GET",url:"/home/deleteFriendRequest",data:{friend_username:a},success:function(c){"error"!==c?(setMessage("success","The friend request from "+a+" was deleted!"),removeFriendFromPendingList(a),createPendingRequestTable(friendsPendingList)):setMessage("error","There was an error deleting the friend request from "+
a)}})},createPostsList=function(a){var c=$("#postList"),b=document.createElement("ul");b.id="postList";b.setAttribute("class","mx-0 px-0");a.forEach(function(a){var e=document.createElement("li"),c=document.createElement("div"),k=document.createElement("div"),h=document.createElement("img"),d=document.createElement("div"),m=document.createElement("p"),g=document.createElement("div"),f=document.createElement("div");c.setAttribute("class","card");c.setAttribute("style","box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);");
k.setAttribute("class","header");h.setAttribute("class","img-thumbnail img-rounded float-left");h.setAttribute("height","100");h.setAttribute("width","100");h.setAttribute("alt","profile image");h.setAttribute("data-toggle","tooltip");h.setAttribute("data-placement","top");h.setAttribute("title",a.poster_username);null===a.profileImage||"null"===a.profileImage?h.setAttribute("src",defaultUserImage):h.setAttribute("src",a.profileImage);d.setAttribute("class","card-body");m.setAttribute("class","card-text");
m.innerText=a.post_text;g.setAttribute("class","card-footer text-muted");f.setAttribute("class","card-text");f.setAttribute("class","card-text");f.innerText="Date: "+formatDate(new Date(a.time_created));e.setAttribute("class","mb-5");k.appendChild(h);d.appendChild(m);g.appendChild(f);c.appendChild(k);c.appendChild(d);c.appendChild(g);e.appendChild(c);b.appendChild(e)});c.replaceWith(b)},getPosts=function(){$.ajax({type:"GET",url:"/home/getPosts",success:function(a){"error"!==a?createPostsList(a):
setMessage("error","An error occurred while retrieving posts.")}})},deleteFriend=function(a){$.ajax({type:"GET",url:"/home/deleteFriend",data:{friend_username:a},success:function(c){"error"!==c?(setMessage("success",a+" was removed from your friends list!"),removeFriendFromList(a),createUserTable(friendsList,!0,"friendsTable")):setMessage("error","There was an error removing "+a+" from your friends list.")}})};
$(document).ready(function(){var a=document.getElementsByTagName("html")[0],c,b="pills-feed-tab";a.addEventListener("touchstart",function(a){var b=a.target.nodeName.toLowerCase();"tbody"!==b&&"thead"!==b&&"table"!==b&&"td"!==b&&"tr"!==b&&"img"!==b&&"a"!==b&&(c=a.touches[0].clientX)},!1);a.addEventListener("touchend",function(a){var e=a.changedTouches[0].clientX-c;a=a.target.nodeName.toLowerCase();"tbody"!==a&&"thead"!==a&&"table"!==a&&"td"!==a&&"tr"!==a&&"img"!==a&&"a"!==a&&(0>e?65<Math.abs(e)&&("pills-feed-tab"===
b?(b="pills-search-tab",$("#pills-search-tab").click()):"pills-search-tab"===b?(b="pills-friends-tab",$("#pills-friends-tab").click()):"pills-friends-tab"===b?(b="pills-profile-tab",$("#pills-profile-tab").click()):"pills-profile-tab"===b&&(b="pills-profile-tab",$("#pills-profile-tab").click())):65<Math.abs(e)&&("pills-profile-tab"===b?(b="pills-friends-tab",$("#pills-friends-tab").click()):"pills-friends-tab"===b?(b="pills-search-tab",$("#pills-search-tab").click()):"pills-search-tab"===b?(b="pills-feed-tab",
$("#pills-feed-tab").click()):"pills-feed-tab"===b&&(b="pills-feed-tab",$("#pills-feed-tab").click())));c=0},!1);window.mobilecheck=function(){var a=!1,b=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,
4)))a=!0;return a};if(window.mobilecheck()||550>$(window).width())$("#usersFullTable").addClass("table-responsive"),$("#friendsPendingFullTable").addClass("table-responsive"),$("#friendsFullTable").addClass("table-responsive");$(window).resize(function(a){window.mobilecheck()||550>$(window).width()?($("#usersFullTable").addClass("table-responsive"),$("#friendsPendingFullTable").addClass("table-responsive"),$("#friendsFullTable").addClass("table-responsive")):($("#usersFullTable").removeClass("table-responsive"),
$("#friendsPendingFullTable").removeClass("table-responsive"),$("#friendsFullTable").removeClass("table-responsive"))});getPosts();$('[data-toggle="tooltip"]').tooltip();$("#createPost").click(function(a){$("#modalPostText").val("");$("#createPostModal").modal("show")});$("#pills-feed-tab").click(function(a){b="pills-feed-tab";getPosts()});$("#createPostModalButton").click(function(a){$("#createPostModal").modal("hide");a=$("#modalPostText").val().trim();0===a.length&&2E3===a.length||$.ajax({type:"POST",
url:"/home/createPost",data:{post_text:a},success:function(a){"error"!==a?(getPosts(),setMessage("success","post was created successfully!")):setMessage("error","An error occurred while creating post.")}})});$("#pills-friends-tab").click(function(a){b="pills-friends-tab";getPendingRequests();getFriends()});$("#pills-search-tab").click(function(a){b="pills-search-tab";userCount=0;userAmount=15;getUsers()});$("#loadMoreUsers").click(function(a){getUsers()});$("#searchSiteButton").click(function(a){searchUserTable()});
$("#searchSiteBar").keypress(function(a){"Enter"===a.key&&searchUserTable()});$("#sendFriendRequest").click(function(a){sendFriendRequest($("#inspectUsername").text())});$("#pills-profile-tab").click(function(a){b="pills-profile-tab";getAdditonalInfo()});$("#imageLink").change(function(a){$("#profileImage").attr("src",$("#imageLink").val().trim())});$("#saveChanges").click(function(a){a={bio:$("#bio").val().trim(),email:$("#email").val().trim(),phoneNumber:$("#phoneNumber").val().trim(),profileImage:$("#imageLink").val().trim()};
$.ajax({type:"POST",method:"POST",url:"/home/updateProfile",data:a,success:function(a){"success"===a?setMessage("success","Your profile was update successfully!"):setMessage("error","There was an error updating your profile.")}})})});