var userCount=0,userAmount=15,defaultUserImage="/profile_images/defaultProfileImage.png",usersList=[],friendsList=[],friendsPendingList=[],formatDate=function(a){var c=a.getHours(),b=a.getMinutes(),d=12<=c?"pm":"am";c%=12;c=(c?c:12)+":"+(10>b?"0"+b:b)+" "+d;return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()+"  "+c},setMessage=function(a,c){"error"===a?($("#errorMessages").text(c),$("#errorMessages").removeClass("hide"),setTimeout(function(){$("#errorMessages").addClass("hide")},1E4)):"success"===
a?($("#successMessages").text(c),$("#successMessages").removeClass("hide"),setTimeout(function(){$("#successMessages").addClass("hide")},1E4)):"info"===a&&($("#infoMessages").text(c),$("#infoMessages").removeClass("hide"),setTimeout(function(){$("#infoMessages").addClass("hide")},1E4))},removeFriendFromList=function(a){friendsList=friendsList.slice(friendsList.indexOf(findUserObj(friendsList,a)),-1)},removeFriendFromPendingList=function(a){friendsPendingList=friendsPendingList.slice(friendsPendingList.indexOf(findUserObj(friendsPendingList,
a)),-1)},findUserObj=function(a,c){var b;a.forEach(function(a){a.Username===c&&(b=a)});return b},getUsers=function(){$.ajax({type:"GET",url:"/home/getUserProfiles",data:{userIndex:userCount,numUsers:userAmount},success:function(a){"error"!==a?(createUserTable(a,0===userCount,"userTable"),usersList=a):setMessage("error","An error occured while getting user info.");userCount+=userAmount}})},createUserTable=function(a,c,b){var d=$("#"+b),n=document.createElement("tbody");n.id=b;"userTable"===b?$("#sendFriendRequest").show():
$("#sendFriendRequest").hide();c?(a.forEach(function(a){var d=document.createElement("tr"),c=document.createElement("td"),e=document.createElement("img"),p=document.createElement("td"),g=document.createElement("div"),f=document.createElement("a"),l=document.createElement("td"),q=document.createElement("td");d.setAttribute("scope","row");null===a.profileImage||"null"===a.profileImage?e.setAttribute("src",defaultUserImage):e.setAttribute("src",a.profileImage);e.setAttribute("alt","profile pic");e.classList.add("img-rounded");
e.classList.add("img-thumbnail");e.setAttribute("height","50");e.setAttribute("width","50");f.setAttribute("href",("#"+a.Username).toString());f.setAttribute("id",a.Username);g.innerText=a.Username;f.addEventListener("click",function(a){a.preventDefault();setUserModal(a.target.innerText,b);$("#inspectUser").modal("show")});l.innerText=a.FirstName;q.innerText=a.LastName;f.appendChild(g);p.appendChild(f);c.appendChild(e);d.appendChild(c);d.appendChild(p);d.appendChild(l);d.appendChild(q);"friendsTable"===
b&&(c=document.createElement("button"),e=document.createElement("td"),c.setAttribute("class","btn btn-danger"),c.setAttribute("type","button"),c.setAttribute("id",a.Username),c.innerText="Remove",c.addEventListener("click",function(a){deleteFriend(a.target.id)}),e.appendChild(c),e.setAttribute("class","text-right"),d.appendChild(e));n.appendChild(d)}),d.replaceWith(n)):a.forEach(function(a){var c=document.createElement("tr"),n=document.createElement("td"),e=document.createElement("img"),p=document.createElement("td"),
g=document.createElement("div"),f=document.createElement("a"),l=document.createElement("td"),q=document.createElement("td");c.setAttribute("scope","row");null===a.profileImage||"null"===a.profileImage?e.setAttribute("src",defaultUserImage):e.setAttribute("src",a.profileImage);e.setAttribute("alt","profile pic");e.classList.add("img-rounded");e.classList.add("img-thumbnail");e.setAttribute("height","50");e.setAttribute("width","50");f.setAttribute("href",("#"+a.Username).toString());f.setAttribute("id",
a.Username);g.innerText=a.Username;f.addEventListener("click",function(a){a.preventDefault();setUserModal(a.target.innerText,b);$("#inspectUser").modal("show")});l.innerText=a.FirstName;q.innerText=a.LastName;f.appendChild(g);p.appendChild(f);n.appendChild(e);c.appendChild(n);c.appendChild(p);c.appendChild(l);c.appendChild(q);d.append(c)})},searchUserTable=function(){userCount=0;userAmount=15;""!==$("#searchSiteBar").val().toString().trim()?$.ajax({url:"/home/searchUsers",data:{searchTerm:$("#searchSiteBar").val().toString().trim()},
success:function(a){"error"!==a?(createUserTable(a,!0,"userTable"),usersList=a):setMessage("error","There was an error while searching for users.")}}):getUsers()},setUserModal=function(a,c){"userTable"===c?usersList.forEach(function(b){b.Username===a&&(null!==b.profileImage&&"null"!==b.profileImage&&$("#inspectProfileImage").attr("src",b.profileImage),$("#inspectUsername").text(b.Username),$("#inspectFirstName").text(b.FirstName),$("#inspectLastName").text(b.LastName),$("#inspectBio").text(b.bio),
$("#inspectEmail").text(b.email),$("#inspectPhoneNumber").text(b.phone_number))}):"friendsTable"===c?friendsList.forEach(function(b){b.Username===a&&(null!==b.profileImage&&"null"!==b.profileImage&&$("#inspectProfileImage").attr("src",b.profileImage),$("#inspectUsername").text(b.Username),$("#inspectFirstName").text(b.FirstName),$("#inspectLastName").text(b.LastName),$("#inspectBio").text(b.bio),$("#inspectEmail").text(b.email),$("#inspectPhoneNumber").text(b.phone_number))}):"friendsPendingTable"===
c&&friendsPendingList.forEach(function(b){b.Username===a&&(null!==b.profileImage&&"null"!==b.profileImage&&$("#inspectProfileImage").attr("src",b.profileImage),$("#inspectUsername").text(b.Username),$("#inspectFirstName").text(b.FirstName),$("#inspectLastName").text(b.LastName),$("#inspectBio").text(b.bio),$("#inspectEmail").text(b.email),$("#inspectPhoneNumber").text(b.phone_number))})},getAdditonalInfo=function(){$.ajax({url:"/home/getAdditionalInfo",success:function(a){"error"!==a?($("#bio").val("null"===
a.bio?"":a.bio),$("#email").val("null"===a.email?"":a.email),$("#phoneNumber").val(null===a.phone_number?"":a.phone_number),$("#profileImage").attr("src","null"===a.profileImage?defaultUserImage:a.profileImage),$("#imageLink").val("null"===a.profileImage?"":a.profileImage)):setMessage("error","There was an error getting your profile information.")}})},sendFriendRequest=function(a){$("#inspectUser").modal("hide");$.ajax({url:"/home/sendFriendRequest",data:{friendTo:a},success:function(a){"error"===
a?setMessage("error","There was an error sending friend request."):"requested"===a?setMessage("error","This friend has already been requested."):setMessage("success","Friend request was sent successfully!")}})},createPendingRequestTable=function(a){var c=$("#friendsPendingTable"),b=document.createElement("tbody");b.id="friendsPendingTable";a.forEach(function(a){var d=document.createElement("tr"),c=document.createElement("td"),k=document.createElement("img"),h=document.createElement("td"),e=document.createElement("div"),
m=document.createElement("a"),g=document.createElement("td"),f=document.createElement("button"),l=document.createElement("button");d.setAttribute("scope","row");null===a.profileImage||"null"===a.profileImage?k.setAttribute("src",defaultUserImage):k.setAttribute("src",a.profileImage);k.setAttribute("alt","profile pic");k.classList.add("img-rounded");k.classList.add("img-thumbnail");k.setAttribute("height","50");k.setAttribute("width","50");m.setAttribute("href",("#"+a.Username).toString());m.setAttribute("id",
a.Username);e.innerText=a.Username;m.addEventListener("click",function(a){a.preventDefault();setUserModal(a.target.innerText,"friendsPendingTable");$("#inspectUser").modal("show")});f.setAttribute("class","btn btn-primary");f.setAttribute("type","button");f.setAttribute("id",a.Username);f.innerText="Accept";f.addEventListener("click",function(a){acceptFriendRequest(a.target.id)});l.setAttribute("class","btn btn-danger");l.setAttribute("type","button");l.setAttribute("id",a.Username);l.innerText="Reject";
l.addEventListener("click",function(a){rejectFriendRequest(a.target.id)});g.setAttribute("class","text-right");g.appendChild(f);g.appendChild(l);m.appendChild(e);h.appendChild(m);c.appendChild(k);d.appendChild(c);d.appendChild(h);d.appendChild(g);b.appendChild(d)});c.replaceWith(b)},getPendingRequests=function(){$.ajax({type:"GET",url:"/home/getPendingFriends",success:function(a){"error"!==a?(friendsPendingList=a,createPendingRequestTable(a)):setMessage("error","error while getting pending friend requests.");
userCount+=userAmount}})},getFriends=function(){$.ajax({type:"GET",url:"/home/getFriends",success:function(a){"error"!==a?(createUserTable(a,!0,"friendsTable"),friendsList=a):setMessage("error","error while getting friends list.");userCount+=userAmount}})},acceptFriendRequest=function(a){$.ajax({type:"GET",url:"/home/addFriend",data:{friend_username:a},success:function(c){"error"!==c?(setMessage("success","You are now friends with "+a+"!"),friendsList.push(findUserObj(friendsPendingList,a)),removeFriendFromPendingList(a),
createUserTable(friendsList,!0,"friendsTable"),createPendingRequestTable(friendsPendingList)):setMessage("error","There was an error accepting the friend request from "+a)}})},rejectFriendRequest=function(a){$.ajax({type:"GET",url:"/home/deleteFriendRequest",data:{friend_username:a},success:function(c){"error"!==c?(setMessage("success","The friend request from "+a+" was deleted!"),removeFriendFromPendingList(a),createPendingRequestTable(friendsPendingList)):setMessage("error","There was an error deleting the friend request from "+
a)}})},createPostsList=function(a){var c=$("#postList"),b=document.createElement("ul");b.id="postList";b.setAttribute("class","mx-0 px-0");a.forEach(function(a){var c=document.createElement("li"),d=document.createElement("div"),k=document.createElement("div"),h=document.createElement("img"),e=document.createElement("div"),m=document.createElement("p"),g=document.createElement("div"),f=document.createElement("div");d.setAttribute("class","card");d.setAttribute("style","box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);");
k.setAttribute("class","header");h.setAttribute("class","img-thumbnail img-rounded float-left");h.setAttribute("height","100");h.setAttribute("width","100");h.setAttribute("alt","profile image");h.setAttribute("data-toggle","tooltip");h.setAttribute("data-placement","top");h.setAttribute("title",a.poster_username);null===a.profileImage||"null"===a.profileImage?h.setAttribute("src",defaultUserImage):h.setAttribute("src",a.profileImage);e.setAttribute("class","card-body");m.setAttribute("class","card-text");
m.innerText=a.post_text;g.setAttribute("class","card-footer text-muted");f.setAttribute("class","card-text");f.setAttribute("class","card-text");f.innerText="Date: "+formatDate(new Date(a.time_created));c.setAttribute("class","mb-5");k.appendChild(h);e.appendChild(m);g.appendChild(f);d.appendChild(k);d.appendChild(e);d.appendChild(g);c.appendChild(d);b.appendChild(c)});c.replaceWith(b)},getPosts=function(){$.ajax({type:"GET",url:"/home/getPosts",success:function(a){"error"!==a?createPostsList(a):
setMessage("error","An error occurred while retrieving posts.")}})},deleteFriend=function(a){$.ajax({type:"GET",url:"/home/deleteFriend",data:{friend_username:a},success:function(c){"error"!==c?(setMessage("success",a+" was removed from your friends list!"),removeFriendFromList(a),createUserTable(friendsList,!0,"friendsTable")):setMessage("error","There was an error removing "+a+" from your friends list.")}})};
$(document).ready(function(){var a=document.getElementsByTagName("html")[0],c,b="pills-feed-tab";a.addEventListener("touchstart",function(a){var b=a.target.nodeName.toLowerCase();"tbody"!==b&&"thead"!==b&&"table"!==b&&"td"!==b&&"tr"!==b&&"img"!==b&&"a"!==b&&(c=a.touches[0].clientX)},!1);a.addEventListener("touchend",function(a){var d=a.changedTouches[0].clientX-c;a=a.target.nodeName.toLowerCase();"tbody"!==a&&"thead"!==a&&"table"!==a&&"td"!==a&&"tr"!==a&&"img"!==a&&"a"!==a&&(0>d?65<Math.abs(d)&&("pills-feed-tab"===
b?(b="pills-search-tab",$("#pills-search-tab").click()):"pills-search-tab"===b?(b="pills-friends-tab",$("#pills-friends-tab").click()):"pills-friends-tab"===b?(b="pills-profile-tab",$("#pills-profile-tab").click()):"pills-profile-tab"===b&&(b="pills-profile-tab",$("#pills-profile-tab").click())):65<Math.abs(d)&&("pills-profile-tab"===b?(b="pills-friends-tab",$("#pills-friends-tab").click()):"pills-friends-tab"===b?(b="pills-search-tab",$("#pills-search-tab").click()):"pills-search-tab"===b?(b="pills-feed-tab",
$("#pills-feed-tab").click()):"pills-feed-tab"===b&&(b="pills-feed-tab",$("#pills-feed-tab").click())));c=0},!1);if(550>$(window).width()||550>window.visualViewport.width||550>window.innerWidth)$("#usersFullTable").addClass("table-responsive"),$("#friendsPendingFullTable").addClass("table-responsive"),$("#friendsFullTable").addClass("table-responsive");$(window).resize(function(a){550>$(window).width()||550>window.visualViewport.width||550>window.innerWidth?($("#usersFullTable").addClass("table-responsive"),
$("#friendsPendingFullTable").addClass("table-responsive"),$("#friendsFullTable").addClass("table-responsive")):($("#usersFullTable").removeClass("table-responsive"),$("#friendsPendingFullTable").removeClass("table-responsive"),$("#friendsFullTable").removeClass("table-responsive"))});getPosts();$('[data-toggle="tooltip"]').tooltip();$("#createPost").click(function(a){$("#modalPostText").val("");$("#createPostModal").modal("show")});$("#pills-feed-tab").click(function(a){b="pills-feed-tab";getPosts()});
$("#createPostModalButton").click(function(a){$("#createPostModal").modal("hide");a=$("#modalPostText").val().trim();0===a.length&&2E3===a.length||$.ajax({type:"POST",url:"/home/createPost",data:{post_text:a},success:function(a){"error"!==a?(getPosts(),setMessage("success","post was created successfully!")):setMessage("error","An error occurred while creating post.")}})});$("#pills-friends-tab").click(function(a){b="pills-friends-tab";getPendingRequests();getFriends()});$("#pills-search-tab").click(function(a){b=
"pills-search-tab";userCount=0;userAmount=15;getUsers()});$("#loadMoreUsers").click(function(a){getUsers()});$("#searchSiteButton").click(function(a){searchUserTable()});$("#searchSiteBar").keypress(function(a){"Enter"===a.key&&searchUserTable()});$("#sendFriendRequest").click(function(a){sendFriendRequest($("#inspectUsername").text())});$("#pills-profile-tab").click(function(a){b="pills-profile-tab";getAdditonalInfo()});$("#imageLink").change(function(a){$("#profileImage").attr("src",$("#imageLink").val().trim())});
$("#saveChanges").click(function(a){a={bio:$("#bio").val().trim(),email:$("#email").val().trim(),phoneNumber:$("#phoneNumber").val().trim(),profileImage:$("#imageLink").val().trim()};$.ajax({type:"POST",method:"POST",url:"/home/updateProfile",data:a,success:function(a){"success"===a?setMessage("success","Your profile was update successfully!"):setMessage("error","There was an error updating your profile.")}})})});