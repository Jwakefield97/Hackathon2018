var userCount=0,userAmount=15,defaultUserImage="/profile_images/defaultProfileImage.png",usersList=[],friendsList=[],friendsPendingList=[],formatDate=function(a){var c=a.getHours(),b=a.getMinutes(),f=12<=c?"pm":"am";c%=12;c=(c?c:12)+":"+(10>b?"0"+b:b)+" "+f;return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()+"  "+c},setMessage=function(a,c){"error"===a?($("#errorMessages").text(c),$("#errorMessages").removeClass("hide"),setTimeout(function(){$("#errorMessages").addClass("hide")},1E4)):"success"===
a?($("#successMessages").text(c),$("#successMessages").removeClass("hide"),setTimeout(function(){$("#successMessages").addClass("hide")},1E4)):"info"===a&&($("#infoMessages").text(c),$("#infoMessages").removeClass("hide"),setTimeout(function(){$("#infoMessages").addClass("hide")},1E4))},removeFriendFromList=function(a){friendsList=friendsList.slice(friendsList.indexOf(findUserObj(friendsList,a)),-1)},removeFriendFromPendingList=function(a){friendsPendingList=friendsPendingList.slice(friendsPendingList.indexOf(findUserObj(friendsPendingList,
a)),-1)},findUserObj=function(a,c){var b;a.forEach(function(a){a.Username===c&&(b=a)});return b},getUsers=function(){$.ajax({type:"GET",url:"/home/getUserProfiles",data:{userIndex:userCount,numUsers:userAmount},success:function(a){"error"!==a?(createUserTable(a,0===userCount,"userTable"),usersList=a):setMessage("error","An error occured while getting user info.");userCount+=userAmount}})},createUserTable=function(a,c,b){var f=$("#"+b),n=document.createElement("tbody");n.id=b;"userTable"===b?$("#sendFriendRequest").show():
$("#sendFriendRequest").hide();c?(a.forEach(function(a){var c=document.createElement("tr"),e=document.createElement("td"),d=document.createElement("img"),f=document.createElement("td"),l=document.createElement("div"),g=document.createElement("a"),h=document.createElement("td"),p=document.createElement("td");c.setAttribute("scope","row");null===a.profileImage||"null"===a.profileImage?d.setAttribute("src",defaultUserImage):d.setAttribute("src",a.profileImage);d.setAttribute("alt","profile pic");d.classList.add("img-rounded");
d.classList.add("img-thumbnail");d.setAttribute("height","50");d.setAttribute("width","50");g.setAttribute("href",("#"+a.Username).toString());g.setAttribute("id",a.Username);l.innerText=a.Username;g.addEventListener("click",function(a){a.preventDefault();setUserModal(a.target.innerText,b);$("#inspectUser").modal("show")});h.innerText=a.FirstName;p.innerText=a.LastName;g.appendChild(l);f.appendChild(g);e.appendChild(d);c.appendChild(e);c.appendChild(f);c.appendChild(h);c.appendChild(p);"friendsTable"===
b&&(e=document.createElement("button"),d=document.createElement("td"),e.setAttribute("class","btn btn-danger"),e.setAttribute("type","button"),e.setAttribute("id",a.Username),e.innerText="Remove",e.addEventListener("click",function(a){deleteFriend(a.target.id)}),d.appendChild(e),d.setAttribute("class","text-right"),c.appendChild(d));n.appendChild(c)}),f.replaceWith(n)):a.forEach(function(a){var c=document.createElement("tr"),e=document.createElement("td"),d=document.createElement("img"),n=document.createElement("td"),
l=document.createElement("div"),g=document.createElement("a"),h=document.createElement("td"),p=document.createElement("td");c.setAttribute("scope","row");null===a.profileImage||"null"===a.profileImage?d.setAttribute("src",defaultUserImage):d.setAttribute("src",a.profileImage);d.setAttribute("alt","profile pic");d.classList.add("img-rounded");d.classList.add("img-thumbnail");d.setAttribute("height","50");d.setAttribute("width","50");g.setAttribute("href",("#"+a.Username).toString());g.setAttribute("id",
a.Username);l.innerText=a.Username;g.addEventListener("click",function(a){a.preventDefault();setUserModal(a.target.innerText,b);$("#inspectUser").modal("show")});h.innerText=a.FirstName;p.innerText=a.LastName;g.appendChild(l);n.appendChild(g);e.appendChild(d);c.appendChild(e);c.appendChild(n);c.appendChild(h);c.appendChild(p);f.append(c)})},searchUserTable=function(){userCount=0;userAmount=15;""!==$("#searchSiteBar").val().toString().trim()?$.ajax({url:"/home/searchUsers",data:{searchTerm:$("#searchSiteBar").val().toString().trim()},
success:function(a){"error"!==a?(createUserTable(a,!0,"userTable"),usersList=a):setMessage("error","There was an error while searching for users.")}}):getUsers()},setUserModal=function(a,c){"userTable"===c?usersList.forEach(function(b){b.Username===a&&(null!==b.profileImage&&"null"!==b.profileImage&&$("#inspectProfileImage").attr("src",b.profileImage),$("#inspectUsername").text(b.Username),$("#inspectFirstName").text(b.FirstName),$("#inspectLastName").text(b.LastName),$("#inspectBio").text(b.bio),
$("#inspectEmail").text(b.email),$("#inspectPhoneNumber").text(b.phone_number))}):"friendsTable"===c?friendsList.forEach(function(b){b.Username===a&&(null!==b.profileImage&&"null"!==b.profileImage&&$("#inspectProfileImage").attr("src",b.profileImage),$("#inspectUsername").text(b.Username),$("#inspectFirstName").text(b.FirstName),$("#inspectLastName").text(b.LastName),$("#inspectBio").text(b.bio),$("#inspectEmail").text(b.email),$("#inspectPhoneNumber").text(b.phone_number))}):"friendsPendingTable"===
c&&friendsPendingList.forEach(function(b){b.Username===a&&(null!==b.profileImage&&"null"!==b.profileImage&&$("#inspectProfileImage").attr("src",b.profileImage),$("#inspectUsername").text(b.Username),$("#inspectFirstName").text(b.FirstName),$("#inspectLastName").text(b.LastName),$("#inspectBio").text(b.bio),$("#inspectEmail").text(b.email),$("#inspectPhoneNumber").text(b.phone_number))})},getAdditonalInfo=function(){$.ajax({url:"/home/getAdditionalInfo",success:function(a){"error"!==a?($("#bio").val("null"===
a.bio?"":a.bio),$("#email").val("null"===a.email?"":a.email),$("#phoneNumber").val(null===a.phone_number?"":a.phone_number),$("#profileImage").attr("src","null"===a.profileImage?defaultUserImage:a.profileImage),$("#imageLink").val("null"===a.profileImage?"":a.profileImage)):setMessage("error","There was an error getting your profile information.")}})},sendFriendRequest=function(a){$("#inspectUser").modal("hide");$.ajax({url:"/home/sendFriendRequest",data:{friendTo:a},success:function(a){"error"===
a?setMessage("error","There was an error sending friend request."):"requested"===a?setMessage("error","This friend has already been requested."):setMessage("success","Friend request was sent successfully!")}})},createPendingRequestTable=function(a){var c=$("#friendsPendingTable"),b=document.createElement("tbody");b.id="friendsPendingTable";a.forEach(function(a){var c=document.createElement("tr"),l=document.createElement("td"),f=document.createElement("img"),e=document.createElement("td"),d=document.createElement("div"),
k=document.createElement("a"),m=document.createElement("td"),g=document.createElement("button"),h=document.createElement("button");c.setAttribute("scope","row");null===a.profileImage||"null"===a.profileImage?f.setAttribute("src",defaultUserImage):f.setAttribute("src",a.profileImage);f.setAttribute("alt","profile pic");f.classList.add("img-rounded");f.classList.add("img-thumbnail");f.setAttribute("height","50");f.setAttribute("width","50");k.setAttribute("href",("#"+a.Username).toString());k.setAttribute("id",
a.Username);d.innerText=a.Username;k.addEventListener("click",function(a){a.preventDefault();setUserModal(a.target.innerText,"friendsPendingTable");$("#inspectUser").modal("show")});g.setAttribute("class","btn btn-primary");g.setAttribute("type","button");g.setAttribute("id",a.Username);g.innerText="Accept";g.addEventListener("click",function(a){acceptFriendRequest(a.target.id)});h.setAttribute("class","btn btn-danger");h.setAttribute("type","button");h.setAttribute("id",a.Username);h.innerText="Reject";
h.addEventListener("click",function(a){rejectFriendRequest(a.target.id)});m.setAttribute("class","text-right");m.appendChild(g);m.appendChild(h);k.appendChild(d);e.appendChild(k);l.appendChild(f);c.appendChild(l);c.appendChild(e);c.appendChild(m);b.appendChild(c)});c.replaceWith(b)},getPendingRequests=function(){$.ajax({type:"GET",url:"/home/getPendingFriends",success:function(a){"error"!==a?(friendsPendingList=a,createPendingRequestTable(a)):setMessage("error","error while getting pending friend requests.");
userCount+=userAmount}})},getFriends=function(){$.ajax({type:"GET",url:"/home/getFriends",success:function(a){"error"!==a?(createUserTable(a,!0,"friendsTable"),friendsList=a):setMessage("error","error while getting friends list.");userCount+=userAmount}})},acceptFriendRequest=function(a){$.ajax({type:"GET",url:"/home/addFriend",data:{friend_username:a},success:function(c){"error"!==c?(setMessage("success","You are now friends with "+a+"!"),friendsList.push(findUserObj(friendsPendingList,a)),removeFriendFromPendingList(a),
createUserTable(friendsList,!0,"friendsTable"),createPendingRequestTable(friendsPendingList)):setMessage("error","There was an error accepting the friend request from "+a)}})},rejectFriendRequest=function(a){$.ajax({type:"GET",url:"/home/deleteFriendRequest",data:{friend_username:a},success:function(c){"error"!==c?(setMessage("success","The friend request from "+a+" was deleted!"),removeFriendFromPendingList(a),createPendingRequestTable(friendsPendingList)):setMessage("error","There was an error deleting the friend request from "+
a)}})},createPostsList=function(a){var c=$("#postList"),b=document.createElement("ul");b.id="postList";b.setAttribute("class","mx-0 px-0");a.forEach(function(a){var c=document.createElement("li"),f=document.createElement("div"),q=document.createElement("div"),e=document.createElement("img"),d=document.createElement("div"),k=document.createElement("p"),m=document.createElement("div"),g=document.createElement("div");f.setAttribute("class","card");f.setAttribute("style","box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);");
q.setAttribute("class","header");e.setAttribute("class","img-thumbnail img-rounded float-left");e.setAttribute("height","100");e.setAttribute("width","100");e.setAttribute("alt","profile image");e.setAttribute("data-toggle","tooltip");e.setAttribute("data-placement","top");e.setAttribute("title",a.poster_username);null===a.profileImage||"null"===a.profileImage?e.setAttribute("src",defaultUserImage):e.setAttribute("src",a.profileImage);d.setAttribute("class","card-body");k.setAttribute("class","card-text");
k.innerText=a.post_text;m.setAttribute("class","card-footer text-muted");g.setAttribute("class","card-text");g.setAttribute("class","card-text");g.innerText="Date: "+formatDate(new Date(a.time_created));c.setAttribute("class","mb-5");q.appendChild(e);d.appendChild(k);m.appendChild(g);f.appendChild(q);f.appendChild(d);f.appendChild(m);c.appendChild(f);b.appendChild(c)});c.replaceWith(b)},getPosts=function(){$.ajax({type:"GET",url:"/home/getPosts",success:function(a){"error"!==a?createPostsList(a):
setMessage("error","An error occurred while retrieving posts.")}})},deleteFriend=function(a){$.ajax({type:"GET",url:"/home/deleteFriend",data:{friend_username:a},success:function(c){"error"!==c?(setMessage("success",a+" was removed from your friends list!"),removeFriendFromList(a),createUserTable(friendsList,!0,"friendsTable")):setMessage("error","There was an error removing "+a+" from your friends list.")}})};
$(document).ready(function(){545>$(window).width()&&($("#usersFullTable").addClass("table-responsive"),$("#friendsPendingFullTable").addClass("table-responsive"),$("#friendsFullTable").addClass("table-responsive"));$(window).resize(function(a){545>$(window).width()?($("#usersFullTable").addClass("table-responsive"),$("#friendsPendingFullTable").addClass("table-responsive"),$("#friendsFullTable").addClass("table-responsive")):($("#usersFullTable").removeClass("table-responsive"),$("#friendsPendingFullTable").removeClass("table-responsive"),
$("#friendsFullTable").removeClass("table-responsive"))});getPosts();$('[data-toggle="tooltip"]').tooltip();$("#createPost").click(function(a){$("#modalPostText").val("");$("#createPostModal").modal("show")});$("#pills-feed-tab").click(function(a){getPosts()});$("#createPostModalButton").click(function(a){$("#createPostModal").modal("hide");a=$("#modalPostText").val().trim();0===a.length&&2E3===a.length||$.ajax({type:"POST",url:"/home/createPost",data:{post_text:a},success:function(a){"error"!==a?
(getPosts(),setMessage("success","post was created successfully!")):setMessage("error","An error occurred while creating post.")}})});$("#pills-friends-tab").click(function(a){getPendingRequests();getFriends()});$("#pills-search-tab").click(function(a){userCount=0;userAmount=15;getUsers()});$("#loadMoreUsers").click(function(a){getUsers()});$("#searchSiteButton").click(function(a){searchUserTable()});$("#searchSiteBar").keypress(function(a){"Enter"===a.key&&searchUserTable()});$("#sendFriendRequest").click(function(a){sendFriendRequest($("#inspectUsername").text())});
$("#pills-profile-tab").click(function(a){getAdditonalInfo()});$("#imageLink").change(function(a){$("#profileImage").attr("src",$("#imageLink").val().trim())});$("#saveChanges").click(function(a){a={bio:$("#bio").val().trim(),email:$("#email").val().trim(),phoneNumber:$("#phoneNumber").val().trim(),profileImage:$("#imageLink").val().trim()};$.ajax({type:"POST",method:"POST",url:"/home/updateProfile",data:a,success:function(a){"success"===a?setMessage("success","Your profile was update successfully!"):
setMessage("error","There was an error updating your profile.")}})})});